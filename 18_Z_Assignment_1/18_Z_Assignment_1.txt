Learning Objectives:-
Perform a rolling update of the container version
Roll back to the previous working state


Problem Statement:-
Your company's developers have just finished developing a new version of their candy-themed mobile game. They are ready to update the backend services that are running in your Kubernetes cluster. There is a deployment in the cluster managing the replicas for this application. The deployment is called candy-deployment. 

candy-deployment.yaml
--------------------------
apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: candy-deployment
spec:
  replicas: 2
  selector:
    matchLabels:
      app: candy-ws
  template:
    metadata:
      labels:
        app: candy-ws
    spec:
      containers:
      - image: linuxacademycontent/candy-service:2
        name: candy-ws


You have been asked to update the image for the container named candy-ws in this deployment template to a new version, linuxacademycontent/candy-service:3.

After you have updated the image using a rolling update, check on the status of the update to make sure it is working. If it is not working, perform a rollback to the previous state.

Make sure that the rolling update is in such a way that atleast 25% of pods are up and running during update with Zero downtime.


Answers-->

kubectl create -f candy-deployment.yml

C:\BACKUP\KUBERNETES\IMP_KUB\18_Z_Assignment_1>kubectl get pods
NAME                              READY   STATUS    RESTARTS   AGE
candy-deployment-6bc9d784-9drw4   1/1     Running   0          65s
candy-deployment-6bc9d784-wjtnq   1/1     Running   0          65s

kubectl set image deployment.apps/candy-deployment candy-ws=linuxacademycontent/candy-service:3 --record
deployment.apps/candy-deployment image updated

kubectl get pods
NAME                                READY   STATUS         RESTARTS   AGE
candy-deployment-5549575cf5-sdq4n   0/1     ErrImagePull   0          6m20s
candy-deployment-6bc9d784-9drw4     1/1     Running        0          9m17s
candy-deployment-6bc9d784-wjtnq     1/1     Running        0          9m17s

  
kubectl describe pod candy-deployment-5549575cf5-sdq4n

Events:
  Type     Reason     Age                     From               Message
  ----     ------     ----                    ----               -------
  Normal   Scheduled  8m21s                   default-scheduler  Successfully assigned default/candy-deployment-5549575cf5-sdq4n to minikube
  Normal   Pulling    6m39s (x4 over 8m20s)   kubelet, minikube  Pulling image "linuxacademycontent/candy-service:3"
  Warning  Failed     6m36s (x4 over 8m17s)   kubelet, minikube  Failed to pull image "linuxacademycontent/candy-service:3": rpc error: code = Unknown desc = Error response from daemon: manifest for linuxacademycontent/candy-service:3 not found: manifest unknown: manifest unknown
  Warning  Failed     6m36s (x4 over 8m17s)   kubelet, minikube  Error: ErrImagePull
  Normal   BackOff    6m21s (x6 over 8m16s)   kubelet, minikube  Back-off pulling image "linuxacademycontent/candy-service:3"
  Warning  Failed     3m14s (x19 over 8m16s)  kubelet, minikube  Error: ImagePullBackOff
  
  
Roll-back -->

kubectl set image deployment.apps/candy-deployment candy-ws=linuxacademycontent/candy-service:2 --record

kubectl get pods
NAME                              READY   STATUS    RESTARTS   AGE
candy-deployment-6bc9d784-9drw4   1/1     Running   0          13m
candy-deployment-6bc9d784-wjtnq   1/1     Running   0          13m








